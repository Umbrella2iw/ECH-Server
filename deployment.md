## `校疫小助手`后端部署教程

1. 首先，请确保源码下载完整，否则跑不起来。

2. 确保安装cnpm或者npm，个人建议安装cnpm，因为使用的是淘宝镜像源，安装速度快。

3. 确保安装了Node.js 13.5.0+和Mysql 5.6。因为本项目是在此版本上进行开发的，低于该版本可能会出现报错现象。

   3.1 如果是服务器上部署，强烈建议安装`pm2`，以便在生产模式下即使服务崩溃了也能立刻重启。

4. 如果你需要进行二次开发，请全局安装`nodemon`，否则无法进入开发模式。如果只是部署服务，则请跳过这一步。

5. 在命令行中输入指令`cnpm/npm install`来安装运行所需要的依赖项。

6. 在启动前，需要执行如下命令：

   6.1 执行`cnpm/npm run db-init`来创建数据库，这里需要注意，如果你没有环境变量`NODE_ENV`，则默认是使用development环境的配置，你可以使用`set NODE_ENV=xxx`等设置环境变量的命令来设置Node.js运行的环境，例如当`NODE_ENV`的值为development或不存在时，后端所有CRUD操作将会在development配置中指定的数据库里进行，若`NODE_ENV`为test，则在test指定的数据库中进行，若为production，则以production配置中的进行。

   6.2 执行`cnpm/npm run migration`命令，完成数据库迁移操作，如果迁移过程中出现错误，那可能是数据库不存在，因为迁移文件经过测试是没有问题的。在操作完成之后，建议使用数据库可视化操作工具连接服务器数据库，查看是否存在26+1张表（其中sequelizemeta表是数据库迁移历史日志表，用于回退操作，其余26张表是后端业务表）

   6.3 对于本地部署，如果不需要进行二次开发，请使用`cnpm/npm run start`命令，这会让Node.js开始解释app.js文件。如果需要二次开发，则使用`cnpm/npm run dev`命令，这会让nodemon开始监听后端文件的变动并自动重启。对于服务器部署，在安装了`pm2`的前提下，请使用`pm2 start app.js`指令运行服务。若没有安装，则建议使用`cnpm/npm run start`命令启动服务。

7. 执行完上述步骤后，如果在控制台中看见一个与Sequelize相关的警告，则表明部署成功了，现在你可以使用`Postman`等后端调试工具来测试后端提供的接口是否可用。